<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script type="text/javascript">
		// var r_list = "{{reports}}";
		// var newName = document.getElementById('newreportname').value;
		// function validateNewName() {
		// 	alert("hello");
		// 	// loop through the existing reports to see if any have the same name as the new name
		// 	for (int i = 0; i < r_list.length; i++) {
		// 		if (r_list[i].reportname == newName) {
		// 			return false;
		// 		}
		// 	}
		// 	return true;
		// }
	</script>
	<script type="text/javascript">
		$(document).ready(function(){

		$('#renameForm').submit(function(){
			var RLIST = {{ reportNames|safe }};
			var newName = document.getElementById('newreportname').value;

			for (i = 0; i < RLIST.length; i++) {
				if (RLIST[i] == newName) {
					alert("A report with that name already exists. Please enter a different name.");
					return false;
				}
			}
			$("<input type='text' value='' />")
		    	.attr("id", ID)
		    	.attr("name", "oldreportname")
		    	.attr("value", ID)
		    	.attr("type", "hidden")
		    	.appendTo("#renameForm");
			return true;
		});

		});
	</script>
	<script type="text/javascript">
		$(document).ready(function(){

		$('#deleteForm').submit(function(){
			$("<input type='text' value='' />")
		    	.attr("id", ID)
		    	.attr("name", "deleteReport")
		    	.attr("value", ID)
		    	.attr("type", "hidden")
		    	.appendTo("#deleteForm");
			return true;
		});
	});
	</script>
	<script type="text/javascript">
		var ID;
		function getId(id) {
			ID = id;
		}
	</script>
	<style type="text/css">
		body {
	    	background-color: lightblue;
		}
		h3 {
			color: navy;
			margin-left: 1em;
		}
		.buttons {
			margin-left: 1em;
			margin-top: 1em;
		}
	</style>
</head>
<body>
	<h3>{{ request.session.firstname }}, your reports are displayed below.</h3>
	<div>
		<table class="table table-striped">
			<tr>
				<th>Report Name</th>
				<th>Summary</th>
				<th>Description</th>
				<th>Does Report Contain Encrypted Files?</th>
				<th>Public/Private</th>
				<th>File(s)</th>
				<th></th>
			</tr>
			{% for report in reports %}
				{% ifequal report.owner request.session.username %}
					<tr> 
						<td>
							<div>{{report.reportname}}</div>
							<button onclick="return getId(this.id);" id="{{report.reportname}}" class="button" data-toggle="modal" data-target="#myModal" style="font-size:8pt; margin-top: 7px;">Rename</button>
						</td>
						<td>{{ report.summary }}</td>
						<td>{{ report.description }}</td>
						<td>{{ report.containsencrypted }}</td>
						<td>{{ report.isprivate }}</td>
						<td>
							{% for r in reportfiles %}
								{% ifequal report.reportname r.reportname %}
									{{ r.uploadfile.name }}
								{% endifequal %}
							{% endfor %}
						</td>
						<td>
							<button onclick="return getId(this.id);" id="{{report.reportname}}" class="button" data-toggle="modal" data-target="#myDeleteModal" style="font-size:8pt; margin-top: 7px;">Delete</button>
						</td>
					</tr>
				{% endifequal %}
			{% endfor %}
		</table>
	</div>
	<div class="buttons">
		<a class="btn btn-primary btn-lg" href="manage_reports">Return to Manage My Reports</a>
	</div>

	<!-- modal to show when process is complete -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabelComplete">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-body">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h3 class="modal-title" id="myModalLabel">Edit Report Name</h3>
					</div>
					<form id="renameForm" method="POST" action="view_reports">
						{% csrf_token %}
						<div class="form-group">
							<label for="newreportname">New Report Name: </label>
							<p style="color: red;">{{ form.newreportname.errors|striptags }}</p>
							{{ form.newreportname }}
						</div>
						<button type="submit" class="btn btn-default" onclick="modal">Change Report Name</button>
					</form>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="myDeleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabelComplete">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-body">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h3 class="modal-title" id="myModalLabel">Delete Report</h3>
					</div>
					<form id="deleteForm" method="POST" action="delete_report">
						{% csrf_token %}
						<h4>Are you sure you would like to delete this report?</h4>
						<button type="submit" class="btn btn-default" onclick="modal">Delete Report</button>
					</form>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384- 0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


</body>
</html>
